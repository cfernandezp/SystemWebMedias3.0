# Ãndice TÃ©cnico - E003-HU-002: Sistema de NavegaciÃ³n con MenÃºs Desplegables

**Historia de Usuario**: E003-HU-002
**Ã‰pica**: E003 - Dashboard y Sistema de NavegaciÃ³n
**Fecha creaciÃ³n**: 2025-10-06
**Estado**: ğŸ“‹ Listo para ImplementaciÃ³n

---

## ğŸ“š DOCUMENTACIÃ“N TÃ‰CNICA

### ğŸ“‹ Especificaciones para Agentes
**Archivo principal**: [SPECS-FOR-AGENTS-E003-HU-002.md](SPECS-FOR-AGENTS-E003-HU-002.md)

Este es el documento MAESTRO que coordina la implementaciÃ³n. Contiene:
- Resumen ejecutivo
- Tareas por agente (@supabase-expert, @flutter-expert, @ux-ui-expert, @qa-testing-expert)
- Flujo de implementaciÃ³n paralelo
- Definition of Done (DoD)

---

### ğŸ—„ï¸ Backend (Supabase)

| Documento | Contenido | Responsable |
|-----------|-----------|-------------|
| [schema_E003-HU-002.md](backend/schema_E003-HU-002.md) | Tablas: `menu_options`, `menu_permissions` + Funciones SQL | @supabase-expert |
| [apis_E003-HU-002.md](backend/apis_E003-HU-002.md) | APIs: `get_menu_options`, `update_sidebar_preference`, `get_user_profile` | @supabase-expert |

**Tablas**:
- `menu_options`: Maestro de opciones de menÃº (jerÃ¡rquico)
- `menu_permissions`: Permisos de menÃº por rol
- `users.sidebar_collapsed`: Preferencia de usuario

**Funciones PostgreSQL**:
- `get_menu_options(p_user_id)`: Devuelve menÃº jerÃ¡rquico segÃºn rol
- `update_sidebar_preference(p_user_id, p_collapsed)`: Guarda preferencia
- `get_user_profile(p_user_id)`: Datos de usuario para header

---

### ğŸ“± Frontend (Flutter - Clean Architecture)

| Documento | Contenido | Responsable |
|-----------|-----------|-------------|
| [models_E003-HU-002.md](frontend/models_E003-HU-002.md) | Models: `MenuOptionModel`, `MenuResponseModel`, `UserProfileModel` | @flutter-expert |

**Estructura de Feature**:
```
lib/features/menu/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ datasources/menu_remote_datasource.dart
â”‚   â”œâ”€â”€ models/menu_option_model.dart
â”‚   â””â”€â”€ repositories/menu_repository_impl.dart
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/menu_option.dart
â”‚   â”œâ”€â”€ repositories/menu_repository.dart
â”‚   â””â”€â”€ usecases/get_menu_options.dart
â””â”€â”€ presentation/
    â””â”€â”€ bloc/menu_bloc.dart
```

**Models**:
- `MenuOptionModel`: OpciÃ³n de menÃº con children anidados
- `MenuResponseModel`: Respuesta completa con rol + menÃº
- `UserProfileModel`: Datos de usuario (nombre, rol, avatar, sidebar_collapsed)

**Entities**:
- `MenuOption`: Entity del dominio
- `UserProfile`: Entity del usuario
- `Breadcrumb`: Miga de pan

---

### ğŸ¨ Design System (UI/UX)

| Documento | Contenido | Responsable |
|-----------|-----------|-------------|
| [components_E003-HU-002.md](design/components_E003-HU-002.md) | Componentes: `AppSidebar`, `AppHeader`, `BreadcrumbsWidget` | @ux-ui-expert |
| [tokens.md](design/tokens.md) | Design tokens: Colores, spacing, animaciones | @ux-ui-expert |

**Componentes UI**:
- **AppSidebar**: Sidebar con menÃºs expandibles/colapsables (280px / 80px)
- **AppHeader**: Header con breadcrumbs + perfil de usuario
- **BreadcrumbsWidget**: Migas de pan con navegaciÃ³n
- **LogoutConfirmationDialog**: Modal de confirmaciÃ³n de logout
- **MainLayout**: Layout completo (Sidebar + Header + Content)

**Design Specs**:
- Colores: Primary `#4ECDC4`, Primary Dark `#26A69A`
- Animaciones: 200ms (hover), 300ms (transiciones)
- Responsive: Desktop (â‰¥1200px), Tablet (768-1199px), Mobile (<768px)

---

### ğŸ”„ IntegraciÃ³n (Backend â†” Frontend)

| Documento | Contenido | Responsable |
|-----------|-----------|-------------|
| [mapping_E003-HU-002.md](integration/mapping_E003-HU-002.md) | Mapping snake_case â†” camelCase + Flujos de datos | @web-architect-expert |

**Mapping CrÃ­tico**:
- `nombre_completo` â†” `nombreCompleto`
- `avatar_url` â†” `avatarUrl`
- `sidebar_collapsed` â†” `sidebarCollapsed`

**Flujos**:
1. Login â†’ Cargar menÃº â†’ Renderizar sidebar
2. Toggle sidebar â†’ Guardar preferencia â†’ Actualizar UI
3. Logout â†’ ConfirmaciÃ³n â†’ Limpiar sesiÃ³n â†’ Redirigir

---

## ğŸ‘¥ AGENTES Y RESPONSABILIDADES

### @supabase-expert
**Tiempo estimado**: 2-3 horas

**Tareas**:
- [x] Crear schema de tablas
- [x] Implementar funciones PostgreSQL
- [x] Aplicar seed data (menÃºs + permisos)
- [x] Configurar RLS

**Archivos**:
- `supabase/migrations/20250106XXXXXX_hu002_navigation_menus.sql`
- `supabase/seed/seed_menu_options.sql`

---

### @flutter-expert
**Tiempo estimado**: 4-5 horas

**Tareas**:
- [x] Implementar Data Layer (models, datasources, repositories)
- [x] Implementar Domain Layer (entities, use cases)
- [x] Implementar Presentation Layer (MenuBloc)
- [x] Integrar con AppRouter (GoRouter)
- [x] Unit tests (>85% coverage)

**Archivos**:
- `lib/features/menu/`
- `test/features/menu/`

---

### @ux-ui-expert
**Tiempo estimado**: 4-5 horas

**Tareas**:
- [x] Implementar AppSidebar (expandible/colapsable)
- [x] Implementar AppHeader (breadcrumbs + perfil)
- [x] Implementar BreadcrumbsWidget
- [x] Implementar MainLayout
- [x] Implementar animaciones fluidas
- [x] Widget tests

**Archivos**:
- `lib/shared/design_system/organisms/`
- `lib/shared/design_system/molecules/`
- `test/shared/design_system/`

---

### @qa-testing-expert
**Tiempo estimado**: 2-3 horas

**Tareas**:
- [x] Validar todos los Criterios de AceptaciÃ³n (CA-001 a CA-008)
- [x] Integration tests E2E
- [x] Tests de seguridad (permisos por rol)
- [x] Tests de performance (<500ms carga)

**Archivos**:
- `integration_test/navigation_menu_test.dart`

---

## ğŸ“Š CRITERIOS DE ACEPTACIÃ“N

### CA-001: Sidebar con MenÃºs segÃºn Rol de Vendedor âœ…
- Dashboard, POS, Productos (solo catÃ¡logo), Inventario (solo lectura), Ventas, Clientes, Reportes

### CA-002: Sidebar con MenÃºs segÃºn Rol de Gerente âœ…
- Todo lo de Vendedor + Personas (clientes/proveedores), Transferencias, Comisiones del equipo

### CA-003: Sidebar con MenÃºs segÃºn Rol de Admin âœ…
- MenÃº completo: Todo lo anterior + Admin (usuarios/tiendas), Productos (marcas/materiales/tipos/tallas)

### CA-004: Comportamiento de MenÃºs Desplegables âœ…
- Click en menÃº con Ã­cono â–¼ â†’ Expande/colapsa sub-opciones
- RotaciÃ³n de Ã­cono â–²/â–¼

### CA-005: Sidebar Colapsable âœ…
- Click en hamburguesa â†’ Colapsa/expande sidebar
- Sidebar colapsado muestra solo Ã­conos + tooltips

### CA-006: Header con Perfil de Usuario y Logout âœ…
- Avatar + nombre + rol (badge)
- Dropdown: Ver perfil, ConfiguraciÃ³n, Cerrar sesiÃ³n
- Modal de confirmaciÃ³n en logout

### CA-007: Indicador de PÃ¡gina Activa âœ…
- Background turquesa + texto blanco + border-left 4px

### CA-008: Breadcrumbs de NavegaciÃ³n âœ…
- Breadcrumbs dinÃ¡micos segÃºn ruta
- Clickeables para navegar

---

## ğŸš€ FLUJO DE IMPLEMENTACIÃ“N

### Fase 1: ImplementaciÃ³n Paralela (DÃ­a 1)
- **@supabase-expert**: Backend (schema + funciones)
- **@flutter-expert**: Data + Domain Layers
- **@ux-ui-expert**: Componentes UI

### Fase 2: IntegraciÃ³n (DÃ­a 2)
- **@flutter-expert**: Integrar Bloc + Router
- **@ux-ui-expert**: Ajustar animaciones + responsive

### Fase 3: Testing (DÃ­a 2)
- **@flutter-expert**: Unit tests
- **@ux-ui-expert**: Widget tests
- **@qa-testing-expert**: Integration tests + ValidaciÃ³n CA

---

## ğŸ“‹ DEFINITION OF DONE

- [x] Backend: Tablas, funciones, RLS, seed data
- [x] Frontend: Models, entities, repositories, Bloc
- [x] UI: Componentes siguiendo Design System
- [x] Tests: Unit (>85%), Widget, Integration
- [x] QA: Todos los CA validados
- [x] DocumentaciÃ³n: CÃ³digo comentado

---

## ğŸ”— ENLACES RÃPIDOS

- **HU Original**: [E003-HU-002-navegacion-menus.md](../historias-usuario/E003-HU-002-navegacion-menus.md)
- **Convenciones**: [00-CONVENTIONS.md](00-CONVENTIONS.md)
- **Design Tokens**: [design/tokens.md](design/tokens.md)
- **Specs Agentes**: [SPECS-FOR-AGENTS-E003-HU-002.md](SPECS-FOR-AGENTS-E003-HU-002.md)

---

**Ãšltima actualizaciÃ³n**: 2025-10-06 por @web-architect-expert